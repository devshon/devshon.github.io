---
layout: single

title: "ë‚˜ë§Œì˜ node ì„œë²„ ë§Œë“¤ê¸°"

categories: BackEnd

tag: [total, node, express, prisma, mysql]
---

> DBëŠ” MySQL ì‚¬ìš©, nodeëŠ” JavaScript ê¸°ë°˜ì´ë¼ SQL ë¬¸ë²•ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ê¸° ìœ„í•´ Prisma ì‚¬ìš©í•  ê²ƒì´ë‹¤.

# A. ì„œë²„ êµ¬ì¶•

### 1.ë””ë ‰í† ë¦¬ ìƒì„±ê³¼ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
// í´ë”ë¥¼ ìƒì„±
mkdir SERVER_NAME

// í´ë”ë¡œ ì´ë™
cd SERVER_NAME

// íŒ¨í‚¤ì§€ ì£¼ì…
npm init -y

// ì½”ë“œ ìˆ˜ì • ì‹œ ì„œë²„ ìë™ë°˜ì˜ì„ ìœ„í•´ nodemon ì„¤ì¹˜
npm i -D nodemon

// express ì„¤ì¹˜
npm i express

// cors ì„¤ì¹˜
npm i cors
```

### 2.package.json íŒŒì¼ì— ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€

```json
"scripts":{
	"start": "nodemon INDEX_FILE_NAME.js",
}
```

### 3.ë³´ì•ˆíŒŒì¼ .envíŒŒì¼ ìƒì„±

DATABASE_URLì€ ë””ë¹„ ìƒì„± í›„ URL ì¶”ê°€ì˜ˆì •

```bash
PORT="8000"
DATABASE_URL="mysql://..."
```

env íŒŒì¼ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ dotenv ì„¤ì¹˜

```bash
npm i -D dotenv
```

### 4.ê¹ƒí—ˆë¸Œ ì‚¬ìš© ì‹œ .gitignoreíŒŒì¼ ìƒì„±

ì €ì¥ì†Œì— í‘¸ì‹œ ì œì™¸í•  í´ë”/íŒŒì¼ ì¶”ê°€

```bash
node_modules
.env
```

### 5.index íŒŒì¼ ìƒì„±

ì„œë²„ë¥¼ ì‹¤í–‰í•  index.js íŒŒì¼ì„ ìƒì„±í•œë‹¤ (ì‘ì„±ìëŠ” server.jsë¡œ ìƒì„±í•¨.)

```js
const http = require("http");
const express = require("express");
const cors = require("cors");

require("dotenv").config(); // env í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„¸íŒ…

const app = express();
app.use(express.json()); // ëª¨ë“  ìš”ì²­ íŒŒë¼ë¯¸í„°ê°€ json íƒ€ì…ìœ¼ë¡œ ë°›ì•„ì˜¤ê²Œ í•¨
app.use(cors()); // ë‹¤ë¥¸ ë„ë©”ì¸/PORT/í”„ë¡œí† ì½œì—ì„œ ëª¨ë“  ì ‘ê·¼í—ˆìš©

app.get("/ping", (req, res) => {
  res.json({ message: "/pong" });
}); // ì„œë²„ í…ŒìŠ¤íŠ¸ìš© ì—”ë“œí¬ì¸íŠ¸

const server = http.createServer(app);
const PORT = process.env.PORT;

server.listen(PORT, () => {
  console.log(`server is listening on PORT ${PORT}`);
});
```

### 6.ì„œë²„ ì‹¤í–‰í•´ë³´ê¸°

ì‹¤í–‰ ì‹œ í„°ë¯¸ë„ì— `server is listening on PORT 8000` ì´ ë– ì•¼í•˜ê³  ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8000/pingìœ¼ë¡œ ì ‘ê·¼ ì‹œ `"message":"pong"`ì´ jsoníŒŒì¼ í˜•ì‹ìœ¼ë¡œ ë“¤ì–´ì™€ì•¼ í•œë‹¤.

```bash
npm run start
```

í˜„ì¬ package.json íŒŒì¼

```json
{
  "name": "dev-server",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "start": "nodemon server.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "express": "4.18.1"
  },
  "devDependencies": {
    "dotenv": "16.0.0",
    "nodemon": "2.0.16"
  }
}
```

---

# B. DB ì„¤ì¹˜

MySQL ì„¤ì¹˜ ê³¼ì •ì€ ğŸ‘‰[ì—¬ê¸°](https://devshon.github.io/reference/MySQL%EC%84%A4%EC%B9%98/)ë¥¼ í´ë¦­í•˜ì„¸ìš”.

### 1.ì„¤ì¹˜ê°€ ì™„ë£Œ ë˜ì—ˆë‹¤ë©´ í„°ë¯¸ë„ì—ì„œ ì ‘ê·¼í•´ë³´ì

```bash
// ì ‘ê·¼ ëª…ë ¹ì–´ë¡œ ì ‘ê·¼ í›„ íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥í•˜ë©´ ì ‘ê·¼ëœë‹¤.
mysql -u root -p
```

### 2.ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€í•˜ê¸°

```bash
// ì‘ì„±ìëŠ” ëª¨ë“  í† ì´í”„ë¡œì íŠ¸ì— ì‚¬ìš©í•  ë””ë¹„ë¥¼ ìƒì„±í•¨ìœ¼ë¡œ ë””ë¹„ëª…ì„ devë¡œ ì‘ì„±
create database DB_NAME;

// ìƒì„± í›„ ë””ë¹„ëª©ë¡ í™•ì¸
show databases;
```

ì´ì œ ì„œë²„ì™€ ë””ë¹„ë¥¼ ì—°ê²°í•˜ê²Œ ë˜ë©´ ë‚´ ì»´í“¨í„° ì•ˆì— ìƒˆë¡œìš´ ì„¸ìƒì„ ë§Œë“¤ ì¤€ë¹„ê°€ ì™„ë£Œëœë‹¤...ğŸ˜

---

# C. Prisma ì—°ê²°

SQLë¬¸ë²•ê³¼ ê°ì²´ë¬¸ë²•ì„ ë§ˆì´ê·¸ë ˆì´ì…˜ í•´ì¤„ prismaë¥¼ ì„¤ì¹˜ëŠ” ğŸ‘‰[ì—¬ê¸°](https://devshon.github.io/reference/ORM-&-Prisma/)ë¥¼ í´ë¦­í•˜ì„¸ìš”.

### 1.ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì™„ë£Œí–ˆë‹¤ë©´ MySQLì—ì„œ í…Œì´ë¸” í™•ì¸í•˜ê¸°

```bash
// ë‹¤ì‹œ mysqlì— ì ‘ê·¼í•œ ë‹¤ìŒ ìƒì„±í•œ ë””ë¹„ì— ì ‘ê·¼
use DB_NAME;

// schemaì— ì‘ì„±í•œ modelì´ ë§ˆì´ê·¸ë ˆì´ì…˜ ë˜ì–´ tableì— ì¶”ê°€ë¨
show tables;
```

ğŸ“Œ ìµœì†Œ í•œê°œì˜ modelì„ ìƒì„±í•˜ê³  ë§ˆì´ê·¸ë ˆì´ì…˜ í•´ì•¼ì§€ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆì–´ìš”.

---

# D. ì„œë²„ì™€ DB ì—°ê²°

### 1.index íŒŒì¼ì— prisma ì„¸íŒ…

í•´ë‹¹ ì½”ë“œ ì¶”ê°€ í›„ ì„œë²„ ì‹¤í–‰í–ˆì„ ë•Œ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë˜ì•¼ ë©ë‹ˆë‹¤. `Error: @prisma/client did not initialize yet. Please run "prisma generate" and try to import it again.` ì—ëŸ¬ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë‹¤ì‹œ ì§„í–‰ í•´ë³´ì„¸ìš”.

```js
const http = require("http");
const express = require("express");
const cors = require("cors");
const { PrismaClient } = require("@prisma/client"); // 1.prisma client ì„ ì–¸

require("dotenv").config();

const app = express();
const prisma = new PrismaClient(); // 2.ë³€ìˆ˜ì— prisma client ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‹´ëŠ”ë‹¤

app.use(express.json());
app.use(cors());

app.get("/ping", (req, res) => {
  res.json({ message: "/pong" });
});

const server = http.createServer(app);
const PORT = process.env.PORT;

const start = async () => {
  try {
    server.listen(PORT, () => console.log(`Server is listening on ${PORT}`));
  } catch (err) {
    console.error("Server ERROR : ", err);
    await prisma.$disconnect(); // 3.ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì„ ë•Œ prisma client ì—°ê²°í•´ì œ ì²˜ë¦¬
  }
};

start();
```

---

ğŸ“Œ ì´ì œ ë‹¤ì–‘í•œ íŒ¨í„´ìœ¼ë¡œ ì„œë²„ë¥¼ í™œìš©í•˜ë©´ ë©ë‹ˆë‹¤. ë ˆì´ì–´ë“œ íŒ¨í„´ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ğŸ‘‰[ì—¬ê¸°](https://devshon.github.io/reference/Layered-pattern/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
ë‹¤ìŒì—” ë°±ê·¸ë¼ìš´ë“œë¡œ ì„œë²„ë¥¼ ê³„ì† ì‹¤í–‰í•˜ëŠ” ê²ƒì„ í•´ì•¼ì§€
